!function(e,t){"use strict";if(null==e)throw new Error("RLDL undefined.");var $=e._$,n;null==t?(n=$.ajax({url:e._cdn+"/static/js/vendor/mustache-min.js",dataType:"script",cache:!0}),n.done(function(){t=Mustache})):(n=$.Deferred(),n.resolve());var r=function(s,i){if(null!=r._singletonInstance)return r._singletonInstance;this.cdn="string"==typeof s?s+"/":e._cdn+"/templates/",this.ext="string"==typeof i?i:"mustache",this.dataType=0===this.cdn.indexOf("/")?"html":"jsonp",this.view={},this.templates={},this.urlToTemplate={},this.helpers={};var o=this;return this.setView=function(e){if("object"!=typeof e)throw new Error("Wrong view data.");this.view=$.extend(this.view,e)},this.setHelpers=function(e){if("object"!=typeof e)throw new Error("Wrong helpers.");$.each(e,function(e,t){"function"==typeof t&&(o.helpers[e]=function(){return t})})},"function"==typeof e.I18n&&this.setHelpers({i18n:function(t,n){return e.I18n.getInstance()._(n(t))}}),this.render=function(e,n){if("object"!=typeof n&&(n={}),void 0==this.templates[e])throw new Error("Template "+e+" not set.");var r=this;return t.render(this.templates[e],$.extend({},r.view,n,r.helpers),r.templates)},this.setTemplateFile=function(e,t){if("string"!=typeof e)throw new Error("Wrong template name.");var r=$.Deferred();if(void 0==t&&(t=e.replace(/_/g,"/")),this.urlToTemplate.hasOwnProperty(t))s.templates[e]=s.urlToTemplate[t],r.resolve();else{var s=this;$.ajax({type:"GET",url:s.cdn+t+"."+s.ext,dataType:s.dataType}).done(function(n){"html"==s.dataType?s.templates[e]=n:s.templates[e]=n.template,s.urlToTemplate[t]=s.templates[e],r.resolve()}).fail(function(){throw r.reject(),new Error("Loading template "+e+" failed.")})}return $.when(r,n)},this.setTemplateString=function(e,t){if("string"!=typeof e)throw new Error("Wrong template name.");if("string"!=typeof t)throw new Error("Wrong template value.");var r=$.Deferred();return this.templates[e]=t,r.resolve(),$.when(r,n)},r._singletonInstance=this,this};r._singletonInstance=null,r.getInstance=function(){return null==this._singletonInstance&&(this._singletonInstance=new r),this._singletonInstance},e.Template=r}("object"==typeof RLDL?RLDL:null,"object"==typeof Mustache?Mustache:null);